<!DOCTYPE html>
<html>
<head>
<title>Spring Core 3.2 - Certification Study Notes</title>

<link href="gcp/prettify.css" type="text/css" rel="stylesheet" />
<script type="text/javascript" src="gcp/run_prettify.js"></script>

<link href="favicon.ico"  rel="icon" type="image/x-icon" />

<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="keywords" content="spring certification, spring, certification, springsource, core, study guide, notes, question, exam">
<meta name="description" content="Core Spring Professional Certification Study Notes / Guides, Resources, Mock Exams">
<meta name="author" content="Arnošt Havelka"> 
</head>

<body>
	<h1>Spring Core 3.2 - Study Notes © 2013 Arnošt Havelka</h1>

	<h2>Disclaimer</h2>
    <p>This artical is heavily based on artical <strong><a href="http://springcert.sourceforge.net/">Core Spring Professional Certification Study Guides, Resources, Mock Exams</a> by Gavin Lasnitzki</strong> (and of course <strong><a href="http://www.selikoff.net/2010/08/20/jeannes-core-spring-3-certification-experiences/">jeanne’s core spring 3 certification experiences</a> by Jeanne Boyarsky</strong>). My notes is just an extenstion (in some areas) and update to spring framework 3.2.x.</p>
    <p>I have <strong>copied / reposted </strong> them, changed the formatting and added where I thought appropriate.</p>
	
	<h2>SpringSource Certification</h2>
	<p>Breakdown of <a href="http://mylearn.vmware.com/mgrReg/plan.cfm?plan=31110&ui=www_cert">certification</a> exam (scope) defined in <a href="http://mylearn.vmware.com/courseware/152239/core-spring-3.0-certification-study-guide.pdf">study guide</a> is:
		<ul>
			<li>Container and test</li>
			<li>AOP</li>
			<li>JDBC</li>
			<li>Transactions</li>
			<li>Web</li>
			<li>REST</li>
			<li>Remoting</li>
			<li>Security</li>
			<li>JMS</li>
			<li>JMX</li>
		</ul>
	</p>

	<h2>Spring Reference Docs 3.2.x</h2>
	<ul>
		<li> Reference Manual ( <a target="_core3" href="http://static.springsource.org/spring/docs/3.2.x/spring-framework-reference/html">HTML</a> / <a target="_core3" href="http://static.springsource.org/spring/docs/3.1.x/spring-framework-reference/pdf/spring-framework-reference.pdf">PDF</a> ) </li>
		<li> <a target="_core3" href="http://static.springsource.org/spring/docs/3.2.x/javadoc-api/">API</a> (Javadoc) </li>
		<li> <a target="_core3" href="http://static.springsource.org/spring/docs/3.2.x/changelog.txt">Change Log</a></li>
	</ul>

	<h2>Spring Framewwork 3.2 - Certification Study Notes</div></h2>

    <h3>1. Container</h3>
    <h3>1.1 General</h3>
    <h4>1.1.1 The potential advantages of using Spring's dependency injection?</h4>
	<ul><strong>Pros:</strong>
		<li>Loosely coupled code</li>
		<li>Autowire</li>
		<li>Dependency checking</li>
	</ul>
    <h3>1.1.2 Dependency injection in XML, using constructor or setter injection</h3>
	<font color='blue' size="4">Constructor</font>
    <p><strong>&lt;constructor-arg/&gt;</strong> -  Only works if there is no ambiguity in args</p>
    <p>Use the following attributes to reduce ambiguity:</p>
    <ul>
		<li>
			&quot;type&quot; matching by specifying argument type
<pre class="prettyprint"><code class="language-xml">&lt;bean id="exampleBean" class="examples.ExampleBean"&gt;
	&lt;constructor-arg type="int"&gt;&lt;value&gt;7500000&lt;/value&gt;&lt;/constructor-arg&gt;
	&lt;constructor-arg type="java.lang.String">&lt;value>abc&lt;/value&gt;&lt;/constructor-arg&gt;
&lt;/bean&gt;
</code></pre>
		</li>
		<li>
			&quot;index&quot; by specifying position (zero  based)
<pre class="prettyprint"><code class="language-xml">&lt;bean id="exampleBean" class="examples.ExampleBean"&gt;
	&lt;constructor-arg index="0"&gt;&lt;value&gt;7500000&lt;/value&gt;&lt;/constructor-arg&gt;
	&lt;constructor-arg index="1">&lt;value>abc&lt;/value&gt;&lt;/constructor-arg&gt;
&lt;/bean&gt;
</code></pre>
		</li>
	</ul>
	<p><strong>C namespace</strong> -  similar to P namespace</p>
<pre class="prettyprint"><code class="language-xml">&lt;beans ...  xmlns:c="http://www.springframework.org/schema/c"&gt;
-- by name
&lt;bean id="foo" class="x.y.Foo" c:bar-ref="bar" c:baz-ref="baz" c:email="foo@bar.com"&gt;
-- by index
&lt;bean id="foo" class="x.y.Foo" c:_0-ref="bar" c:_1-ref="baz"&gt;
</code></pre>

	<font color='blue' size="4">Setter</font>
	<p><strong>&lt;property/&gt;</strong></p>
<pre class="prettyprint"><code class="language-xml">&lt;bean id="exampleBean" class="examples.ExampleBean"&gt;
	&lt;property name="value" value="my value"/&gt; -- literal value
	&lt;property name="service" ref="myService"/&gt; -- refence to other bean
&lt;/bean&gt;
</code></pre>
	<p><strong>P namespace</strong></p>
<pre class="prettyprint"><code class="language-xml">&lt;beans ...  xmlns:p="http://www.springframework.org/schema/p"&gt;
&lt;bean id="foo" class="x.y.Foo" p:value="my value" p:service-ref="myService"/&gt;
</code></pre>

    <h4>1.1.3 Scopes</h4>
    <p>Supported</p>
	<ul>
		<li>Singleton (default)</li>
		<li>Prototype</li>
		<li>Web (request, session and global session)</li>
    </ul>

	<h3>1.2 Lifecycle</h3>
    <h4>1.2.1 How to declare an initialization method in a Spring bean?</h4>
	<ul>
		<li>XML: &lt;bean ... <strong>init-method</strong>="init"&gt;</li>
		<li>JSR-250: <strong>@PostConstruct</strong></li>
		<li>Implement <strong>BeanPostProcessors#xyzProcessBeforeInitialization</strong></li>
		<li>Implement <strong>InitializingBean</strong></li>
	</ul>
    <h4>1.2.2 How to declare a destroy method in a Spring bean?</h4>
	<ul>
		<li>XML: &lt;bean ... <strong>destroy-method</strong>="finish"&gt;</li>
		<li>JSR-250: <strong>@PreDestroy</strong></li>
		<li>Implement <strong>DisposableBean</strong></li>
	</ul>
    <h4>1.2.3 Default bean instantiation policy: when are beans instantiated?</h4>
    <p>For Singleton, when app context is created / parsed</p>
    <p>To specify instantiation policy</p>
	<ul>
		<li>Use &quot;lazy-init&quot; on the  &quot;bean&quot; element</li>
		<li>Use the &quot;default-lazy-init&quot; on the  &quot;beans&quot; element</li>
	</ul>
    <p><font color='blue' size="4">Lifecycle:</font>
	<svg style="width:400px; height:350px;">
		<text x="80" y="20">Definition of application context</text>
		<line x1="180" y1="35" x2="180" y2="80" stroke="#000000" stroke-width="2"/>
		<line x1="170" y1="70" x2="180" y2="80" stroke="#000000" stroke-width="2"/>
		<line x1="190" y1="70" x2="180" y2="80" stroke="#000000" stroke-width="2"/>
		<text x="190" y="65" fill="blue">1</text>
		
		<text x="0" y="130">BFPP</text>
		<line x1="20" y1="110" x2="100" y2="110" stroke="#000000" stroke-width="2"/>
		<line x1="90" y1="100" x2="100" y2="110" stroke="#000000" stroke-width="2"/>
		<line x1="90" y1="120" x2="100" y2="110" stroke="#000000" stroke-width="2"/>
		<text x="40" y="105" fill="blue">2 + 3</text>
					
		<rect x="100" y="80" width="150" height="60" stroke="#000000"	stroke-width="4" fill="#AAAAFF" />
		<text x="120" y="120">Bean Definition</text>
		
		<line x1="180" y1="140" x2="180" y2="180" stroke="#000000" stroke-width="2"/>
		<line x1="170" y1="170" x2="180" y2="180" stroke="#000000" stroke-width="2"/>
		<line x1="190" y1="170" x2="180" y2="180" stroke="#000000" stroke-width="2"/>
		<text x="190" y="165" fill="blue">4 + 5</text>
		
		<text x="0" y="230">BPP</text>
		<line x1="20" y1="210" x2="100" y2="210" stroke="#000000" stroke-width="2"/>
		<line x1="90" y1="200" x2="100" y2="210" stroke="#000000" stroke-width="2"/>
		<line x1="90" y1="220" x2="100" y2="210" stroke="#000000" stroke-width="2"/>
		<text x="40" y="205" fill="blue">7 + 10</text>

		<rect x="100" y="180" width="150" height="60" stroke="#000000"	stroke-width="4" fill="#AAAAFF" />
		<text x="140" y="220">Instance</text>
		
		<line x1="180" y1="240" x2="180" y2="290" stroke="#000000" stroke-width="2"/>
		<line x1="170" y1="280" x2="180" y2="290" stroke="#000000" stroke-width="2"/>
		<line x1="190" y1="280" x2="180" y2="290" stroke="#000000" stroke-width="2"/>
		<text x="190" y="275" fill="blue">5</text>
		
		<text x="160" y="310">Ready</text>
	</svg>
	<ol><strong>Init:</strong>
		<li>Load all  bean definitions to create an ordered graph (the  container tries to set properties and resolve dependencies as late as possible)</li>
		<li>Instantiate bean definition</li>
		<li>Instantiate each bean</li>
		<li>Set properties</li>
		<li>BeanPostProcessors (#postProcessBeforeInitialization)</li>
		<li>@PostConstruct</li>
		<li>InitializingBean (#afterPropertiesSet)</li>
		<li>Call init-method</li>
		<li>BeanPostProcessors (#postProcessAfterInitialization)</li>
	</ol>
	<ol><strong>Destroy:</strong>
		<li>@PreDestroy</li>
		<li>DisposableBean (#destroy)</li>
		<li>Call destroy-method</li>
	</ol>
	<p><font color='blue' size="4">Mem:</font>
	<ul>
		<li>Order (by component): XML: context, BFPP, new, set, BPP#before,  init[@PostConstruct, Init#after, init-method], BPP#after, dispose[@PreDestroy,  Disp#destroy, destroy-method]</li>
		<li>Sequence (by type): init / destroy order is: (@) annotation, (#)  interface method, (-) xml attribute</strong></li>
	</ul>
	<font color='blue' size="4">What are BeanFactoryPostProcessors and BeanPostProcessors? When are  they called in the startup process?</font>
	<ul><strong>BeanFactoryPostProcessors</strong>
		<li>Each processor is called once per xml (i.e per  application context)</li>
		<li>Before beans are instantiated</li>
		<li>Can change bean configuration / definitions</li>
		<li>If BeanFactoryPostProcessors are marked as being  lazily-initialized they will NOT be instantiated and will NOT apply their logic.</li>
	</ul>
	<ul><strong>BeanPostProcessors</strong>
		<li>Each processor is called once per bean</li>
		<li>Can run before / after a bean is initialised </li>
	</ul>
	<h4><font color='brown'>1.x What is a BeanFactory?</font></h4>
	<p>Underlying basis for Spring's IoC functionality</p>	

	<h3>1.3 Annotations</h3>
	<h4>1.3.1 Enabling component-scanning</h4>
	<ul><strong>&lt;context:component-scan /&gt;</strong>
		<li>Looks for @Component (general), @Controller (web),  @Repository (dao) and @Service (service)</li>
		<li>Can set context:include-filter and context:exclude-filter  elements</li>
	</ul>
	<p>Example:</p>
<pre class="prettyprint"><code class="language-xml">&lt;context:component-scan  base-package="org.example"&gt;
    &lt;context:include-filter type="regex"  expression=".*Stub.*Repository"/&gt;
    &lt;context:exclude-filter type="annotation"  expression="org.springframework.stereotype.Repository"/&gt;
&lt;/context:component-scan>
</code></pre>
	<h4>1.3.2 Behavior of the annotation @Autowired with regards to field  injection, constructor injection and method injection</h4>
	<ul>Modes:
		<li><strong>no</strong>: (default) No auto-wiring will be performed.  You must wire the dependencies explicitly.</li>
		<li>byName: For each bean property, wire a bean with  the same name as the property.</li>
		<li>byType: For each bean property, wire a bean  whose type is compatible with that of the property.</li>
		<li>constructor: If a default constructor with no  argument is found, the dependencies will be auto-wired by type. Otherwise, they  will be auto-wired by constructor.</li>
	</ul>
	<p>If &gt; 1 match, throws exception (unless injecting into  Collection). <br>
		If no matches, autowiring fails unless using @Required or  &quot;required&quot; attribute</p>
	<p>May be applied to: </p>
	<ul>
		<li>setter methods</li>
		<li>methods with arbitrary names and/or multiple  arguments</li>
		<li>constructors</li>
		<li>fields (even private ones)</li>
		<li>arrays (whereby all beans of a particular type  from the ApplicationContext are injected)</li>
		<li>typed collections</li>
		<li>typed maps (as long as the key is a  java.lang.String )</li>
	</ul>
	<h4>1.3.3 How does the @Qualifier annotation complement the use of @Autowired?</h4>
	<ul>
		<li><strong>@Qualifier(name)</strong> - specifies specific bean name if desired (e.g. to choose one of many beans of same type)</li>
		<li>the bean name is considered as a default qualifier value (when no quilifier is defined)</li>
	</ul>
	<h4>1.3.4 What is the role of the @PostConstruct and @PreDestroy annotations?</h4>
	<p>Similar to init-method and destroy-method </p>
	<h4>1.3.5 Enabling the scanning of annotations such as @Required and  @PreDestroy?</h4>
	<p>Use <strong>&lt;context:annotation-config /&gt;</strong> for (Spring's @Required and @Autowired, JSR  250's @PostConstruct, @PreDestroy and @Resource, PA's @PersistenceContext and  @PersistenceUnit) </p>
	<ul>
		<li>&lt;context:component-scan /&gt; can also do what &lt;context:annotation-config /&gt; does but &lt;context:component-scan /&gt; also scans packages to find and register beans within the application context.</li>
		<li>@Required goes on setters, not fields</li>
		<li>@PostConstruct, @PreDestroy goes on methods</li>
	</ul>
	<h4><font color='brown'>1.3.x6 Scheduled tasks</font></h4>
	<ul>
		<li>@Scheduled(fixedDelay=5000)</li>
		<li>@Async</li>
	</ul>
	<h4><font color='brown'>1.3.x7 SpEL</font></h4>
	<ul>
		<li>Code: (new  SpelExpressionParser()).parseExpression(&quot;numberGuess.randomNumber&quot;).getValue(target)</li>
		<li>Xml: value=&quot;#{numberGuess.randomNumber}&quot;/&gt;</li>
		<li>Annotation:  @Value(&quot;#{numberGuess.randomNumber}&quot;)</li>
	</ul>

	<h3>1.4 Miscellaneous</h3>
	<h4>1.4.1 How to inject scalar/literal values into Spring beans?</h4>
<pre class="prettyprint"><code class="language-xml">&lt;bean id="exampleBean" class="examples.ExampleBean"&gt;
	&lt;property ...&gt;<strong>&lt;value&gt;b@b.com&lt;/value&gt;</strong>&lt;/property&gt; -- element
	&lt;property ... <strong>value=&quot;b@b.com&quot;</strong> /&gt; -- attribute
	&lt;bean ...  <strong>p:email=&quot;b@b.com&quot;</strong> /&gt; - P namespace
&lt;/bean&gt;
</code></pre>
	<ul>
		<li>Empty: &lt;property  name=&quot;email&quot;&gt;&lt;value/&gt;&lt;/property&gt;</li>
		<li>Null: &lt;property name=&quot;a&quot;&gt;&lt;null  /&gt;&lt;/property&gt;</li>
		<li>Compound property names: person.address.streetNo</li>
	</ul>
	<h4>1.4.2 How to refer to a collection in a Spring bean definition?</h4>
	<p>List</p>
<pre class="prettyprint"><code class="language-xml">&lt;list&gt;
    &lt;ref  bean="one" /&gt;
&lt;/list&gt;
</code></pre>
	<p>Set</p>
<pre class="prettyprint"><code class="language-xml">&lt;set&gt;
    &lt;ref bean="one" /&gt;
&lt;/set&gt;
</code></pre>
	<p>Properties</p>
<pre class="prettyprint"><code class="language-xml">&lt;props&gt;
    &lt;prop key="a" value="b" /&gt;
&lt;/props&gt;
</code></pre>
	<p>Map</p>
<pre class="prettyprint"><code class="language-xml">&lt;map&gt;
    &lt;entry key="a" value="b" /&gt;
&lt;/map&gt;
</code></pre>
	<p>or</p>
<pre class="prettyprint"><code class="language-xml">&lt;map&gt;
    &lt;entry&gt;
        &lt;key&gt;
            &lt;value>a&lt;/value&gt;
        &lt;/key&gt;
        &lt;value&gt;b&lt;/value&gt;
    &lt;/entry&gt;
&lt;/map&gt;
</code></pre>
	<ul>
		<li>The value of a map key or value, or a set value, can also again be any of the following elements: bean | ref | idref | list | set | map | props | value | null</li>
		<li>If you need to refer to this outside a &lt;bean /&gt; or  need to specify list/set/map type, use util namespace (i.e. util:list)</li>
		<li>Use the &quot;parent&quot; attribute to inherit (and  merge entries) from a parent collection.</li>
		<li>Strongly typed collections - Entries will be converted to the appropriate  type prior to being added to the Collection</li>
	</ul>
	<h4>1.4.3-1 How to create an ApplicationContext? </h4>
<pre class="prettyprint"><code class="language-java">ApplicationContext ctx = new ClasspathXmlApplicationContext("one.ctx","two.ctx");</code></pre>
	<p>Supports multiple resources</p>
	<h4>1.4.3-2 What are the resource prefixes that can be used? </h4>
	<ul>
		<li>classpath:</li>
		<li>file:</li>
		<li>http:</li>
	</ul>
	<h4>1.4.3-3 How to refer to a Spring configuration file inside a package? </h4>
<pre class="prettyprint"><code class="language-java">new ClasspathXmlApplicationContext("/com/mine/app-config.xml");</code></pre>
	<h4>1.4.3-4 The different implementations of ApplicationContext that can be used in an application</h4>
	<ul><strong>ClasspathXmlApplicationContext</strong>
		<li>Defaults to classpath:</li>
		<li>Starts looking from root of classpath regardless  of whether specify &quot;/&quot;</li>
	</ul>
	<ul><strong>FileSystemXmlApplicationContext</strong>
		<li>Defaults to file:</li>
		<li>Uses relative path even if specify  &quot;/&quot;, but &quot;file:/mine&quot; forces an absolute path</li>
	</ul>
	<ul><strong>XmlWebApplicationContext</strong>
		<li>Defaults to file: in  /WEB-INF/applicationContext.xml</li>
		<li>Uses path relative to web application</li>
	</ul>
	<h4>1.4.4 How to externalize constants from a Spring XML configuration file  into a .properties file?</h4>
	<font color='blue' size="4">context:property-placeholder</font>
<pre class="prettyprint"><code class="language-xml">&lt;context:property-placeholder location="/myFile.properties" /&gt;</code></pre>
	Usage XML:
<pre class="prettyprint"><code class="language-xml">&lt;bean id="mind" class="Mine"&gt;
	&lt;property  name="a" value="${myProperty}" /&gt;
&lt;/bean&gt;</code></pre>
	Usage annotation:
<pre class="prettyprint"><code class="language-java">@Value("${myProperty}")
private String value;</code></pre>
	<font color='blue' size="4">util:properties</font>
		<p>Configuration:</p>
<pre class="prettyprint"><code class="language-xml">&lt;util:properties id="myProperties" location=&quot;property file&quot; /&gt;
</code></pre>
	<p>Usage:</p>
<pre class="prettyprint"><code class="language-java">@Value("#{myProperties[myPropName]}") // specify property file and configuration item
private String myField; 

@Value("#{myPropName}") // if there is only one property file
private String myField; 
</code></pre>
	<h4>1.4.5 Purpose and usage of bean definition inheritance</h4>
      <p>Extract common bean setup into one &quot;super&quot; bean  to reduce duplicate setup code</p>
<pre class="prettyprint"><code class="language-xml">&lt;bean id="parentBean" class="MyClass" abstract="true" /&gt;
&lt;bean id="child" parent="parentBean" class="MyDerivedClass"/&gt;
</code></pre>
	<ul>
		<li>A bean without  a class or factory is implicitly abstract.</li>
		<li>The &quot;abstract&quot; attribute is optional but good  practice as it prevents the bean from being instantiated by the container.</li>
		<li>The parent class does not have to be abstract and can  still be instantiated using the new operator.</li>
	</ul>
	<h4>1.4.6 How to use the p namespace?</h4>
	<p>Set property as attributes</p>
<pre class="prettyprint"><code class="language-xml">&lt;beans ...  xmlns:p="http://www.springframework.org/schema/p"&gt;
&lt;bean id="foo" class="x.y.Foo" 
	<strong>p:value</strong>="my value" -- literal value
	<strong>p:service-ref</strong>="myService"/&gt; -- bean reference
</code></pre>
	<h4><font color='brown'>1.4.x Difference between &quot;id&quot; and &quot;name&quot; attributes in  the &lt;bean&gt; tag</font></h4>
	<p>Identifiers (id and/or name) must be unique within the container that hosts the bean. You are not required to supply a name or id for a bean.  If no name or id is supplied explicitly, the container generates a unique name  for that bean. However, if you want to refer to that bean by name you must  provide a name.</p>
	<ul>
		<li><strong>Id</strong> - must be unique (legal characters are limited)</li>
		<li><strong>Name</strong> - can specify multiple names separated by comma,  semicolon or space (allows more characters in name such as slashes)</li>
	</ul>
	<h4><font color='brown'>1.4.x Purpose of the &lt;aop:scoped-proxy/&gt; tag</font></h4>
	<p>If need to inject a bean with request/session scope into  a bean with singleton scope,  the proxy  intercepts it and makes sure you get the right bean for each call. </p>
<pre class="prettyprint"><code class="language-xml">&lt;bean id="userPref" scope="session"&gt;
	&lt;scoped-proxy/&gt;
&lt;/bean&gt;

&lt;bean ...&gt;
	&lt;property ref="userPref"/&gt;
&lt;/bean&gt;
</code></pre>
	<h4><font color='brown'>1.4.x How does FactoryBean work (Optional, From 2.5 sample questions)?</font></h4>
	<ul>
		<li>Class name in bean definition (in xml) is that of the factory</li>
		<li>Setters called on the factory rather than the created bean</li>
		<li>Bean id maps to type returned by factory's getObject() method</li>
		<li>To get the actual FactoryBean instance from the container  and not the bean it produces, you preface the bean id with the ampersand symbol</li>
	</ul>
<pre class="prettyprint"><code class="language-java">getBean(&quot;myBean&quot;) -- returns reference of bean created by FactoryBean
getBean(&quot;&amp;myBean&quot;) -- returns reference of the FactoryBean instance itself
</code></pre>
	<h4><font color='brown'>1.4.x How to inject using a factory method?</font></h4>
	<ul>
		<li>Instance (non-static) factory method: specify  &quot;factory-bean&quot; and &quot;factory-method&quot; attributes</li>
		<li>Static factory method: specify &quot;class&quot; and  &quot;factory-method&quot; attributes</li>
	</ul>
<pre class="prettyprint"><code class="language-xml">&lt;!-- the factory bean, which contains a method called createInstance() --&gt;
&lt;bean id="serviceLocator" class="examples.DefaultServiceLocator"&gt;
	&lt;!-- inject any dependencies required by this locator bean --&gt;
&lt;/bean&gt;

&lt;!-- the bean to be created via the factory bean --&gt;
&lt;bean id="clientService"
      factory-bean="serviceLocator"
      factory-method="createClientServiceInstance"/&gt;
</code></pre>
	<h4><font color='brown'>1.4.x Splitting the XML</font></h4>
	<ul>
		<li>&lt;import resource=&quot;local path&quot; /&gt;, path is relative to the definition file</li>
		<li>Prefer &quot;multiple resource locations&quot; as configs are unaware of each other</li>
		<li>Use classpath:/.. or file:.. if need an absolute path</li>
	</ul>
	<h4><font color='brown'>1.4.x Use constants in configuration</font></h4>	
	<p>XML:</p>
<pre class="prettyprint"><code class="language-xml">&lt;util:constant id="maxInt" static-field="java.lang.Integer.MAX_VALUE"/&gt;
</code></pre>
	<p>Java:</p>
<pre class="prettyprint"><code class="language-java">public class Foo {
    @Value("T(java.lang.Integer).MAX_VALUE")
    private Integer myValue;
}
</code></pre>

	<h3>1.5 JavaConfig </h3>
	<h4>1.5.1 Usage of the @Bean and @Configuration annotations</h4>
	<p><strong>@Configuration</strong></p>
	<ul>
		<li>Declares a class to be a Spring's Java based configuration</li>
		<li>Must have default constructor or none</li>
	</ul>
	<p><strong>@Bean</strong> - declares a method as spring bean (in a Java based configuration). Properties are:</p>
	<ul>
		<li>initMethod (redundant because can call method)</li>
		<li>destroyMethod</li>
		<li>name (aliases)</li>
		<li>autowire (defaults to no)</li>
	</ul>
	<p>Other usefull annotations:</p>
	<ul>
		<li><strong>@Scope(&quot;prototype&quot;)</strong> - to change default (singleton) scope</li>
		<li><strong>@Primary</strong> - indicates that a bean should be given preference when multiple candidates are qualified to autowire a single-valued dependency</li>
		<li><strong>@DependsOn</strong> - beans on which the current bean depends</li>
		<li><strong>@Import</strong> - to reference another @Configuration (you can't just call it directly as calls must be in the correct order in dependency graph)</li>
		<li><strong>@ComponentScan("com.acme.app.services")</strong> - same as &lt;context:component-scan/&gt; in XML configuration</li>
		<li><strong>@PropertySource("classpath:/com/acme/app.properties")</strong> - see example:
<pre class="prettyprint"><code class="language-java">@Configuration
@PropertySource("classpath:/com/acme/app.properties")
public class AppConfig {
    @Inject Environment env;
    @Bean
    public MyBean myBean() {
        return new MyBean(env.getProperty("bean.name"));
    }
}
</code></pre>
		</li>
	</ul>
	<h4>1.5.2 How to write a bean definition method?</h4>
<pre class="prettyprint"><code class="language-java">@Bean // Defines a String bean with the id &quot;myBean&quot; and  the value &quot;hi&quot;
public String myBean() {
	return &quot;hi&quot;;
}
</code></pre>

	<h3>1.6 Testing</h3>
	<font color='blue' size="4">Unit testing</font>
	<ul>
		<li>Mock Objects (JNDI, Servlet API, etc.)</li>
		<li>Unit Testing support Classes (ReflectionTestUtils,  ModelAndViewAssert, etc.)</li>
	</ul>
	<font color='blue' size="4">Integration testing</font>
	<ul>
		<li>To manageSpring IoC container caching (by fixture) between test execution.</li>
		<li>To provide Dependency Injection of test fixture instances.</li>
		<li>To provide transaction management appropriate to integration testing.</li>
		<li>To supply Spring-specific support classes that are useful in writing integration tests.</li>
		<li>Support for JDBC, annotations, Spring MVC, etc.</li>
	</ul>
	<h4>1.6.1 How to use Spring's integration testing support in a JUnit 4 test?</h4>
	<p>Annotations @RunWith(SpringJUnit4ClassRunner) and @ContextConfiguration provides the benefits of the TestContext framework</p>
<pre class="prettyprint"><code class="language-java"><strong>@RunWith(SpringJUnit4ClassRunner.class)</strong>
<strong>@ContextConfiguration("classpath:/META-INF/spring/hello-app-context.xml")</strong>
public class HelloServiceDefaultTest {

	@Autowired
	private HelloService service;

	@Test
	public void testSimpleProperties() throws Exception {
		assertNotNull(service);
	}
}
</code></pre>
	<p>Others:</p>
	<ul>
		<li>Annotation @ContextConfiguration uses sufix "-context.xml"to define default XML configuration, e.g. FooTest-context.xml for test FooTest.java</li>
		<li>@ContextConfiguration(locations={&quot;config.xml&quot;}) - to define more XML configurations</li>
		<li>@Autowire does not work on constructors</li>
		<li>The context is cached across test fixtures  unless you use @DirtiesContext.</li>
		<li>The &quot;inheritLocations&quot; attribute of  the annotation (default to true) inherits (appended to current list) the  super-classes locations</li>
		<li>@WebAppConfiguration - to ensure that a WebApplicationContext is loaded for your test</li>
		<li>@ContextHierarchy - to define a hierarchy of ApplicationContexts for integration tests
<pre class="prettyprint"><code class="language-java">@WebAppConfiguration
@ContextHierarchy({
    @ContextConfiguration(classes = AppConfig.class),
    @ContextConfiguration(classes = WebConfig.class)
})
public class WebIntegrationTests {
    // class body...
}
</code></pre>
		</li>
	</ul>
	<h4>1.6.2 How to declare that a test should run in a transaction in  spring-enabled JUnit 4?</h4>
	<ul>
		<li>By default, the framework will create and roll back a  transaction for each test.</li>
		<li>@TransactionConfiguration - to override default rollback policy</li>
		<li>@Transactional - on class or method, can set propagation/isolation/etc</li>
		<li>@Rollback - on class or method</li>
		<li>@BeforeTransaction (@Before is inside txn)</li>
		<li>@AfterTransaction (@After is inside txn)</li>
	</ul>
	<h4>1.6.3 Differences between a Unit test and an Integration test. Which of them is supposed to interact with Spring?</h4>
	<ul>
		<li>Unit test tests one class in isolation with mocks.</li>
		<li>Integration test tests multiple classes together.</li>
		<li>Only integration tests interact with Spring.</li>
	</ul>


	<h2>2. AOP</h2>
	<h3>2.1 Recommendations</h3>
	<h4>2.1.1 In order to work successfully with AOP, it is important to understand  the theory behind the scenes. Consequently you should understand the four main  AOP keywords taught in this course: Aspect, Advice, Pointcut, Joinpoint.</h4>
	<ul>
		<li>AOP is technology to solve cross-cutting concerns (authentication, logging, transacations, etc.)</li>
		<li>Spring uses AOP proxy: object created by AOP to implement the aspect contracts</li>
		<li>Targeted object: object being advised</li>
		<li>MEM: For Aspect A when program reaches a Joinpoint that  matches Pointcut P then execute Advice X</li>
		<li><strong>Aspect</strong>: a modularization of a concern that cuts across multiple classes (packaged advice and pointcut).</li>
		<li><strong>Joinpoint</strong>: a point during the execution of a program (when advice is mapped to be executed), such as the execution of a method or the handling of an exception.</li>
		<li><strong>Advice</strong>: action taken by an aspect at a particular join point (code to execute).</li>
		<li><strong>Pointcut</strong>: the place in code where code can be injected (expression to identify join point). In Spring this is just before/after methods.</li>
	</ul>

	<h3>2.2 Pointcuts</h3>
	<h4>2.2.1 You should have a deep understanding of pointcut expressions. It is important to understand all pointcut examples in the slides (apart from the ones in the &quot;advanced topics&quot; section at the end of the module).</h4>
	<ul>MEM:
		<li>Definition: <strong>execution([modifiers or annotations] ReturnType [FullyQualifiedClassName.] MethodName ([Arguments]) [throws ExceptionType])</strong></li>
		<li>Example: [public] String [a.b.c.MyClass] [doWork](String) throws RuntimeException</li>
		<li>&quot;..&quot; means 0 or more (arguments or packages)</li>
		<li>&quot;*&quot; means exactly 1 of anything (argument,  package name, etc)</li>
		<li>&quot;+&quot; means this class or any implementors (no  matter how deep)</li>
		<li>&amp;&amp;, ||, ! (and, or and not)</li>
		<li>Pointcut will be matched against public methods only!</li>
	</ul>
	<ul>Other expressions I think are outside the scope of the  exam:
		<li>within - certain types</li>
		<li>bean - id or name of Spring bean</li>
		<li>target - target object is an instance of the  given type</li>
		<li>this - bean ref is an instance of the given type</li>
		<li>args - args are instances of given type</li>
		<li>@target, @args, @within, @annotation .. has annotation of..</li>
	</ul>
	<p>Declaration:</p>
<pre class="prettyprint"><code class="language-java">@Pointcut(&quot;execution(* transfer(..))&quot;)  // the pointcut expression
private void anyOldTransfer() {} // the pointcut signature
</code></pre>

	<h3>2.3 Advice</h3>
	<h4>2.3.1 Different kinds of Advice. How do they differ from each other? </h4>
	<ul>
		<li>Use either <strong>ref pointcut</strong> or <strong>in-place pointcut</strong>
			<ul>
				<li>Example of ref: @Before(&quot;x.y.myOperation()&quot;) where @Pointcut(&quot;within(x.y.*)&quot;)  private void myOperation(){} </li>
				<li>Example of in-place: @Before(&quot;within(x.y.*)&quot;)</li>
			</ul>
		</li>
		<li>Prefer least powerful advice that can do the job</li>
		<li>Declare a JoinPoint parameter to get access to methods  like: getArgs, getTarget, etc. Example of binding for of args:
<pre class="prettyprint"><code class="language-java">@Before("... && args(account,..))")
public doAdvice(Account account)
</code></pre>
		</li>
	</ul>
	<ul><strong>@Before</strong>:
		<li>Before call code </li>
		<li>Aborts if throw exception</li>
		<li>Can prevent target method being called</li>
	</ul>
	<ul><strong>@After</strong>:
		<li>After unconditionally</li>
		<li>Handles normal and exception return</li>
		<li>Can change return value or throw an exception </li>
	</ul>
	<ul><strong>@AfterReturning</strong>
		<li>After on success only </li>
		<li>Can change return value but it is not possible  to return a totally different reference when using after-returning advice.</li>
		<li>Use:
<pre class="prettyprint"><code class="language-java">@AfterReturning(pointcut="...", returning="retval") 
public void doAdvice(Object retVal)
</code></pre>
		</li>
	</ul>
	<ul><strong>@AfterThrowing</strong>:
		<li>After on failure only </li>
		<li>Can change exception type thrown</li>
		<li>Use:
<pre class="prettyprint"><code class="language-java">@AfterThrowing(pointcut=&quot;...&quot;, throwing=&quot;ex&quot;)
public void doAdvice(Exception ex)
</code></pre>
		</li>
	</ul>
	<ul><strong>@Around</strong>:
		<li>Surrounds </li>
		<li>Takes ProceedingJoinPoint, can intercept call or  ignore exception</li>
		<li>First parameter of the advice method must be of  type ProceedingJoinPoint</li>
		<li>Call proceed() on the ProceedingJoinPoint to  execute the method</li>
	</ul>

	<h3>2.4 Configuration </h3>
	<h4>2.4.1 Enabling the detection of @Aspect annotated classes. </h4>
	<p>&lt;aop:aspectj-autoproxy /&gt;</p>
	<h4>2.4.2 Is it possible to set up Spring AOP using XML configuration only (as  opposed to annotations)? </h4>
	<p>Yes.</p>
<pre class="prettyprint"><code class="language-xml">&lt;aop:config&gt;
    &lt;aop:aspect ref="adviceBean"&gt;
    &lt;aop:before pointcut="execution...." /&gt;
&lt;/aop:config&gt;
</code></pre>

	<h3>2.5 Proxies </h3>
	<h4>2.5.1-1 When are they generated in the Spring lifecycle?</h4>
	<p>Bean Post Processing </p>
	<h4>2.5.1-2 How do they resemble the target object that they advice? </h4>
	<p>They have the same public interface if there is an interface. You must have an interface or non-final class to create a proxy.</p>
	<h4>2.5.1-3 What limitations does Spring-AOP's proxy-based approach have? </h4>
	<ul>
		<li>Can only be used for methods</li>
		<li>Limited pointcut syntax</li>
		<li>Doesn't get called if caller makes direct calls (due to proxy)</li>
		<li>Final classes cannot have aspects applied (proxy does not work)</li>
	</ul>
	<h4><font color='brown'>2.5.x How are aspects detected by Spring AOP?</font></h4>
	<p>Use @Component (with class path scanning)  or register with: &lt;bean  id=&quot;myAspect&quot; class=&quot;org.xyz.NotVeryUsefulAspect&quot;&gt;...</p>
	  
	
	<h3>3. Data Access and transactions</h3>
	<h3>3.1 General</h3>
	<h4>3.1.1 The rationale for having the DataAccessException hierarchy.</h4>
	<ul>
		<li>Runtime exception – doesn't force developers to  catch and rethrow</li>
		<li>Consistent/non-vendor specific messages –  isolates from database</li>
		<li>Clearer names – easy to catch and handle  specific errors</li>
	</ul>
	<h4>3.1.2 Definition  of a DataSource in the Spring configuration </h4>
	<ul>
		<li>JNDI:
<pre class="prettyprint"><code class="language-xml">&lt;jee:jndi-lookup id=&quot;ds&quot; jndi-name=&quot;java:comp/env/jdbc/DS&quot; /&gt;
</code></pre>
		</li>
		<li>Spring bean:
<pre class="prettyprint"><code class="language-xml">&lt;bean id="dataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource"&gt;
    &lt;property name="driverClassName" value="${jdbc.driverClassName}"/&gt;
    &lt;property name="url" value="${jdbc.url}"/&gt;
    &lt;property name="username" value="${jdbc.username}"/&gt;
    &lt;property name="password" value="${jdbc.password}"/&gt;
&lt;/bean&gt;
</code></pre>
		</li>
	</ul>
	<h3>3.2 The JdbcTemplate </h3>
	<h4>3.2.1 Usage of the JdbcTemplate with regards to exception handling </h4>
	<p>JdbcTemplate:</p>
	<ul>
		<li>Stateful – it maintains a  reference to a DataSource, but this state is not conversational state</li>
		<li>Thread-safe - once configured</li>
		<li>SQL Exception is converted to DataAccessException hierarchy</li>
		<li>Depends on datasource instance (JdbcTemplate jdbc = new JdbcTemplate(datasource);)</li>
		<li>Use NamedParameterJdbcTemplate when want param names (i.e  &quot;... where x=:myparam&quot;) rather than classic placeholder (i.e  &quot;... where x=?&quot;)</li>
		<li>Use SimpleJdbcTemplate (JDK 1.5) which delegates to  JDBCTemplate and makes use of some of the JDK 1.5 features (such as var-args)</li>
	</ul>
	<p>Spring and you:</p>
	<ul>
		<li>(You) Define  connection parameters.</li>
		<li>(Spring) Open the connection.</li>
		<li>(You) Specify the SQL statement.</li>
		<li>(You) Declare parameters and provide parameter values.</li>
		<li>(Spring) Prepare and execute the statement.</li>
		<li>(Spring) Set up  the loop to iterate through the results (if any).</li>
		<li>(You) Do the work for each iteration.</li>
		<li>(Spring) Process any exception.</li>
		<li>(Spring) Handle transactions.</li>
		<li>(Spring) Close the connection, statement and resultset.</li>
	</ul>
	<p>Key methods:</p>
	<ul>
		<li>queryForInt | queryForLong - get concreate value (&quot;select count(*) from table&quot;);</li>
		<li>queryForObject – convert to specified type </li>
		<li>queryForMap – convert to a map with the column name as key</li>
		<li>queryForList – list of maps (rows)</li>
		<li>getJdbcOperations – get interface to allow invocation of less commonly used methods</li>
	</ul>
	<p>MEM:</p>
	<ul>
		<li>RowMapper – to handle mapping of rows returned from a REF cursor</li>
		<li>RowCallbackHandler – when we need to write out data to file but not return it</li>
		<li>ResultSetExtractor – extracts values from each row of a ResultSet into one entity</li>
	</ul>

	<p>Examples of data querying:</p>
<pre class="prettyprint"><code class="language-java">// querying with parameters
jdbc.queryFor____(String sql, Object[] args)
jdbc.queryFor____("select count(*) from table where  col > ? and col < ?", new Object[] {10, 2}); 
jdbc.queryFor____(String sql, Object... args) 


// usage of mapping entity
RowMapper<A> mapper = new RowMapper<A>() {
    public A  mapRow(ResultSet rs, int row) throws SQLException {...}
};
jdbc.query(sql, mapper); // use with query (generally for a list)
jdbc.queryForObject(sql, mapper); // load a single entity


// usage of writting out data
RowCallbackHandler handler = new RowCallbackHandler() {
    public void  processRow(ResultSet rs) {...}
};
jdbc.query(sql, handler);


// usage of mapping resultset into entity
ResultSetExtractor<A> extractor = new  ResultSetExtractor<A>() {
    public A extractData(ResultSet rs) {...};
};
jdbc.query(sql,  extractor);
</code></pre>
	<p>Examples of special operations:</p>
<pre class="prettyprint"><code class="language-java">// querying for DML (insert/update/delete row)
jdbc.update(sql);
jdbc.update(PreparedStatementCreator, KeyHolder)


// executing DDL
jdbc.execute(sql);


// executing batch update
BatchPreparedStatementSetter setter = new  BatchPreparedStatementSetter() {
    public void  setValues(PreparedStatement stmt, int row) {}
    public int  getBatchSize() { return 0; }
}
jdbcTemplate.batchUpdate(sql, setter); // or pass  Object[] as second parameter
</code></pre>

	<h3>3.3 Hibernate</h3>
	<h4>3.3.1 Configuration of a SessionFactoryBean in xml</h4>
	<p>Instances:</p>
	<ul>
		<li><strong>LocalSessionFactoryBean</strong> - supports a list of Hibernate XML  mapping locations (use mappingLocations).
<pre class="prettyprint"><code class="language-xml">&lt;bean id="sf" class="os.orm.hibernate3.LocalSessionFactoryBean"&gt;
    &lt;property name="dataSource" ref="d" /&gt;
    &lt;property name="mappingLocations"&gt;
        &lt;list&gt;
            &lt;value&gt;classpath:/package/hbm.xml&lt;/value&gt;
        &lt;/list&gt;
    &lt;/property>
&lt;/bean> 
</code></pre>
		</li>
		<li><strong>AnnotationSessionFactoryBean</strong> - extends LocalSessionFactoryBean and adds support
			<ul>
				<li><strong>annotatedClasses</strong> - for a list of annotated classes (wildcards are not supported)</li>
				<li><strong>packagesToScan</strong> - for packages to scan</li>
			</ul>
<pre class="prettyprint"><code class="language-xml">&lt;bean id="sf" class="os.orm.hibernate3.annotation.AnnotationSessionFactoryBean"&gt;
    &lt;property name="dataSource" ref="d" /&gt;
    &lt;property name="annotatedClasses"&gt;
        &lt;list&gt;
            &lt;value&gt;Class1&lt;/value&gt;
            &lt;value&gt;Class2&lt;/value&gt;
        &lt;/list&gt;
    &lt;/property&gt;
&lt;/bean&gt;
</code></pre>
		</li>
	</ul>
	<p>Read only transactions prevent Hibernate from flushing session.</p>

	
	<h3>3.4 Transactions </h3>
	<h4>3.4.1 Configuration to declare a local transaction manager</h4>
<pre class="prettyprint"><code class="language-xml">&lt;bean id="mgr" class="org.springframework.jdbc.datasource.DataSourceTransactionManager"&gt;
    &lt;property  name="dataSource" ref="dataSource"/&gt;
&lt;/bean&gt;
</code></pre>
	<ul>
		<li><strong>HibernateTransactionManager</strong> - supports Hibernate and JDBC</li>
		<li><strong>JdbcTransactionManager</strong> - only supports JDBC</li>
		<li><strong>JpaTransactionManager</strong> - supports JPA and JDBC</li>
		<li>etc.</li>
	</ul>
	<h4>3.4.2 Configuration to declare a JTA transaction manager</h4>
<pre class="prettyprint"><code class="language-xml">&lt;bean id=&quot;mgr&quot; class=&quot;org.springframework.transaction.jta.JtaTransactionManager&quot;&gt;
    &lt;property  name="dataSource" ref="dataSource"/&gt;
&lt;/bean&gt;
</code></pre>
	<p>or</p>
<pre class="prettyprint"><code class="language-xml">&lt;tx:jta-transaction-manager /&gt;
</code></pre>
	<h4>3.4.3 The different ways to do declarative transaction management with Spring (xml, annotations)</h4>
    <p>We have to define transaction manager first (see previous chapters).</p>
	<font color='blue' size="4">XML</font>
<pre class="prettyprint"><code class="language-xml">&lt;aop:config&gt;
    &lt;aop:advisor  pointcut-ref="p" advice-ref="ta" /&gt;
&lt;/aop:config&gt;

&lt;tx:advice  id="ta"&gt;
    &lt;tx:attributes&gt;
        &lt;tx:method name="update*" timeout="60" /&gt;
        &lt;tx:method name="*" timeout="30"  read-only="true" /&gt;
    &lt;/tx:attributes&gt;
&lt;/tx:advice&gt;
</code></pre>
	<font color='blue' size="4">Annotations</font>
	<p>Use annotation <strong>@Transactional</strong> as:</p>
	<ul>
		<li>applicable on public methods or class</li>
		<li>not applicable on non-public methods - there will be no error, but no transaction will be applied</li>
		<li>not recommend on interfaces b/c not all proxies will take them</li>
	</ul>
	<h4>3.4.4 Usage of TransactionTemplate for programmatic transaction management  (you simply need to understand a basic example based on the TransactionTemplate).</h4>
	<ul>
		<li>Takes transaction manager in constructor</li>
		<li>Passes TransactionStatus to TransactionCallback which lets you call status.setRollbackOnly()</li>
	</ul>
	<p>Example:</p>
<pre class="prettyprint"><code class="language-java">public Object  someServiceMethod() {
    return  transactionTemplate.execute(new TransactionCallback() {
        public Object  doInTransaction(TransactionStatus status) {
            updateOperation1();
            return  resultOfUpdateOperation2();
        }
    });
}
</code></pre>
	<h4>3.4.5 Transactions and exception management: what is the default rollback policy? Can it be overridden?</h4>
	<ul>
		<li>Default policy is rollback for a RuntimeException.</li>
		<li>Default policy can be overriden - for the @Transactional annotation, specify <strong>rollbackFor</strong> or <strong>noRollbackFor</strong> when passing Class or rollbackForClassname/noRollbackForClassname when passing Strings.</li>
	</ul>
	<h4>3.4.6 The @Transactional annotation: what are the main attributes that can be used for a transaction definition? Can this annotation also be used with a JTA Transaction Manager?</h4>
	<p>Main attributes of @Transactional annotation are:</p>
	<ul>
		<li><strong>timeout</strong> - specified in seconds</li>
		<li><strong>readOnly</strong> - true or false</li>
		<li><strong>isolation</strong> - Isolation.READ_UNCOMMITTED, READ_COMMITTED,  REPEATABLE_READ or SERIALIZABLE</li>
		<li><strong>propagation</strong> - Propagation.REQUIRES_NEW, REQUIRED, etc.</li>
		<li><strong>rollbackFor</strong> or <strong>rollbackForClassname</strong> - list of exceptions</li>
		<li><strong>noRollbackFor</strong> or <strong>noRollbackForClassname</strong> - list of exceptions</li>
	</ul>
    <p>Yes, @Transactional annotation can be used with JTA Transaction Manager.</p>

</body>
</html>